app-id: io.github.celluloid_player.Celluloid
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: celluloid
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=all
  - --share=network
  - --socket=pulseaudio
  - --filesystem=xdg-run/pipewire-0:ro
  - --filesystem=xdg-pictures
  - --filesystem=xdg-run/gvfs
  - --filesystem=xdg-run/gvfsd
  - --talk-name=org.gtk.vfs.*
  - --env=LC_NUMERIC=C
  - --env=YT_DLP_JS_RUNTIME=deno
modules:
  - name: celluloid
    buildsystem: meson
    config-opts:
      - --buildtype=release
    cleanup:
      - /share/man
    sources:
      - type: archive
        url: https://github.com/celluloid-player/celluloid/releases/download/v0.29/celluloid-0.29.tar.xz
        sha256: 5b9991557cc2764a8281a24aa726a645287eb075cde0f0ae7c737965264a119c
        x-checker-data:
          type: anitya
          project-id: 193876
          stable-only: true
          url-template: https://github.com/celluloid-player/celluloid/releases/download/v$version/celluloid-$version.tar.xz
          is-main-source: true

    modules:
      - name: libmpv
        cleanup:
          - /include
          - /lib/pkgconfig
          - /share/applications
          - /share/bash-completion
          - /share/doc
          - /share/icons
          - /share/man
          - /share/zsh
        buildsystem: meson
        config-opts:
          - -Dlibmpv=true
          - -Dbuild-date=false
          - -Dalsa=disabled
          - -Dlua=enabled
        sources:
          - type: archive
            url: https://github.com/mpv-player/mpv/archive/v0.40.0.tar.gz
            sha256: 10a0f4654f62140a6dd4d380dcf0bbdbdcf6e697556863dc499c296182f081a3
            x-checker-data:
              type: anitya
              project-id: 5348
              stable-only: true
              url-template: https://github.com/mpv-player/mpv/archive/v$version.tar.gz
              is-important: true

        modules:
          - shared-modules/lua5.1/lua-5.1.5.json

          - name: libass
            cleanup:
              - /include
              - /lib/*.la
              - /lib/pkgconfig
            config-opts:
              - --disable-static
            sources:
              - type: archive
                url: https://github.com/libass/libass/releases/download/0.17.4/libass-0.17.4.tar.xz
                sha256: 78f1179b838d025e9c26e8fef33f8092f65611444ffa1bfc0cfac6a33511a05a
                x-checker-data:
                  type: anitya
                  project-id: 1560
                  stable-only: true
                  url-template: https://github.com/libass/libass/releases/download/$version/libass-$version.tar.xz

          - name: uchardet
            buildsystem: cmake-ninja
            config-opts:
              - -DCMAKE_BUILD_TYPE=Release
              - -DBUILD_STATIC=0
              - -DCMAKE_POLICY_VERSION_MINIMUM=3.5
            cleanup:
              - /bin
              - /include
              - /lib/pkgconfig
              - /share/man
              - /lib/cmake
            sources:
              - type: archive
                url: https://www.freedesktop.org/software/uchardet/releases/uchardet-0.0.8.tar.xz
                sha256: e97a60cfc00a1c147a674b097bb1422abd9fa78a2d9ce3f3fdcc2e78a34ac5f0
                x-checker-data:
                  type: anitya
                  project-id: 9265
                  stable-only: true
                  url-template: https://www.freedesktop.org/software/uchardet/releases/uchardet-$version.tar.xz

          - name: rubberband
            buildsystem: meson
            config-opts:
              - -Ddefault_library=shared
            cleanup:
              - /bin
              - /include
              - /lib/pkgconfig
              - /lib/ladspa
            sources:
              - type: archive
                url: https://breakfastquay.com/files/releases/rubberband-4.0.0.tar.bz2
                sha256: af050313ee63bc18b35b2e064e5dce05b276aaf6d1aa2b8a82ced1fe2f8028e9
                x-checker-data:
                  type: anitya
                  project-id: 4222
                  stable-only: true
                  url-template: https://breakfastquay.com/files/releases/rubberband-$version.tar.bz2

          - name: mujs
            cleanup:
              - /bin
              - /include
              - /lib/pkgconfig
              - /lib/libmujs.a
            no-autogen: true
            make-args:
              - release
              - prefix=/app
            make-install-args:
              - prefix=/app
              - install-shared
            sources:
              - type: git
                url: https://codeberg.org/ccxvii/mujs.git
                tag: 1.3.8
                commit: 307f18c4216420f2f56e22d8e7040baa39a6304a
                x-checker-data:
                  type: git
                  tag-pattern: ^([\d.]+)$
              - type: file
                url: https://www.unicode.org/Public/16.0.0/ucd/UnicodeData.txt
                sha256: ff58e5823bd095166564a006e47d111130813dcf8bf234ef79fa51a870edb48f
              - type: file
                url: https://www.unicode.org/Public/16.0.0/ucd/SpecialCasing.txt
                sha256: 8d5de354eef79f2395a54c9c7dcebbaf3d30fc962d0f85611ea97aa973a0c451

          - name: libplacebo
            buildsystem: meson
            cleanup:
              - /include
              - /lib/pkgconfig
            sources:
              - type: git
                url: https://github.com/haasn/libplacebo.git
                commit: 3188549fba13bbdf3a5a98de2a38c2e71f04e21e
                x-checker-data:
                  type: git
                  tag-pattern: ^v([\d.]+)$
                tag: v7.351.0
              - type: patch
                path: libplacebo-vulkan-python-xml.patch

  - name: yt-dlp
    modules:
      - name: deno
        buildsystem: simple
        build-commands:
          - install -Dm755 deno /app/bin/deno
        sources:
          - type: archive
            url: https://github.com/denoland/deno/releases/download/v2.5.6/deno-x86_64-unknown-linux-gnu.zip
            sha256: fd4f6abc1b6a134fa9a4dba56519f1631f44c88e04e4e3e9a8ff5975dfa66e1a
            only-arches: [x86_64]
          - type: archive
            url: https://github.com/denoland/deno/releases/download/v2.5.6/deno-aarch64-unknown-linux-gnu.zip
            sha256: f5e60ae3dfceb61e5e5a41f22129e40a8bc17f6393b59e75d7ca19ceef32d824
            only-arches: [aarch64]

      - name: yt-dlp-ejs
        buildsystem: simple
        build-commands:
          - pip3 install --prefix=/app yt_dlp_ejs*.whl
        sources:
          - type: file
            url: https://files.pythonhosted.org/packages/e7/fd/34fbdaf0d53386c47e219c532a479766cd9336fde34c00834c8e0123df7a/yt_dlp_ejs-0.3.1-py3-none-any.whl
            sha256: a6e3548874db7c774388931752bb46c7f4642c044b2a189e56968f3d5ecab622
            x-checker-data:
              type: pypi
              name: yt-dlp-ejs
              packagetype: bdist_wheel

    no-autogen: true
    no-make-install: true
    make-args:
      - yt-dlp
      - PYTHON=/usr/bin/python3
    post-install:
      - install yt-dlp /app/bin

    sources:
      - type: git
        url: https://github.com/yt-dlp/yt-dlp.git
        tag: 2025.11.12
        commit: 5977782142ca7e41240f07202cc9b8dcc087b401
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+)$



